---

- name: Perform initial server setup
  hosts: apps
  tasks:
    - name: Perform initial server setup
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.server_setup
      tags: [server_setup]

- name: Deploy and configure foundation apps
  hosts: apps
  tasks:
    - name: Install and configure Vault
      tags: [vault, never]
      block:
        - name: Install vault
          ansible.builtin.import_role:
            name: jaredhocutt.homelab.vault

        - name: Flush handlers
          ansible.builtin.meta: flush_handlers

        - name: Wait for user confirmation to continue
          ansible.builtin.pause:
            prompt: "Vault has been installed. Press ENTER to continue with the rest of the deployment..."

    - name: Install authentik
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.authentik
      tags: [authentik]

- name: Deploy and configure apps
  hosts: apps
  tasks:
    - name: Install audiobookshelf
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.audiobookshelf
      tags: [audiobookshelf]

    - name: Install calibre
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.calibre
      tags: [calibre]

    - name: Install changedetection
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.changedetection
      tags: [changedetection]

    - name: Install healthchecks
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.healthchecks
      tags: [healthchecks]

    - name: Install immich
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.immich
      tags: [immich]

    - name: Install kometa
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.kometa
      tags: [kometa]

    - name: Install n8n
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.n8n
      tags: [n8n]

    - name: Install open_webui
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.open_webui
      tags: [open_webui]

    - name: Install overseerr
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.overseerr
      tags: [overseerr]

    - name: Install paperless
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.paperless
      tags: [paperless]

    - name: Install prowlarr
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.prowlarr
      tags: [prowlarr]

    - name: Install radarr
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.radarr
      tags: [radarr]

    - name: Install sabnzbd
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.sabnzbd
      tags: [sabnzbd]

    - name: Install sonarr
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.sonarr
      tags: [sonarr]

    - name: Install stirling_pdf
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.stirling_pdf
      tags: [stirling_pdf]

    - name: Install tautulli
      ansible.builtin.import_role:
        name: jaredhocutt.homelab.tautulli
      tags: [tautulli]
